<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
	<title>Lemma</title>
	<link rel="stylesheet" href="chui/chui.css" />
	<link rel="stylesheet" href="css/lemma.css" />
	<script src="chui/chocolatechip.js" type="text/javascript"></script>
	<script src="chui/chui.js" type="text/javascript"></script>
	<script src="js/jsOAuth-1.2.min.js" type="text/javascript"></script>
	<script src="js/key.js" type="text/javascript"></script>
	<script src="js/lemma.js" type="text/javascript"></script>
	<script src="js/list.js" type="text/javascript"></script>
	<script src="js/search.js" type="text/javascript"></script>
	<script src="js/navigation.js" type="text/javascript"></script>
	<script src="js/datehelper.js" type="text/javascript"></script>
	<script type="text/javascript">
		/* Local JavaScript Here */	
		function doRefresh( since_id, insert_more ) {
			var url = 'http://api.twitter.com/1/statuses/home_timeline.json';

			updateViewName('Retrieving tweets...', CONST_LOADING);
									
			if (insert_more === undefined) {
				insert_more = false;
			}
			if (since_id === undefined) {
				url = url + '?count=' + status_count;
			}
			else {
				url = url + '?count=' + status_count;
				url = url + '&max_id=' + since_id;
				$('#more_timeline').remove();
			}
			
			oauth.get(url,
				function(data) {
					var json_data = JSON.parse(data.text);

					updateTimeline(json_data, insert_more, CONST_HOME);
					
					current_view = 'All';
					updateViewName('All', CONST_HOME);
					untouchButtons();
				}
			);
		}
		
		function doAction( tweet_id ) {
			var action_id = 'actionsheet' + tweet_id;
			
			// Set the ID of the tweet for the actions.
			reply_id = tweet_id.substring(6, (tweet_id.length + 1));
			
			// Set the text (marked up and raw) of the tweet.
			str_tweet = $('#' + tweet_id).innerHTML;
			str_tweet_raw = $('#raw_' + tweet_id).innerHTML;
			str_tweet_user = $('#user_' + tweet_id).innerHTML;
			
			var opts = {
				id : action_id,
				title : str_tweet,
				color : "black",
				uiButtons : [
					{ title : "Reply", callback: "respondToReplyButton" }, 
					{ title : "Retweet", callback: "respondToRetweetButton" }, 
					{ title : "Retweet With Message", callback: "respondToRetweetWithMessageButton" }, 
					{ title : "Send Direct Message", callback: "respondToDirectMessageButton" }, 
					{ title : "Favourite", callback: "respondToFavouriteButton" }
				]
			};
			$.body.UIActionSheet(opts);
			
			$.UIShowActionSheet('#' + action_id);
		}
		
		function respondToReplyButton() {
			$('#tweet_textarea').value = '@' + str_tweet_user + ' ';
			$('#in_reply_to_status_id').fill(reply_id);
			$("#tweet_result").empty();
			gotoPage('#tweet_view');
			countTweetChars();
			
			setTimeout("setCaretToPos($('#tweet_textarea'), " + (str_tweet_user.length + 2) + ", " + (str_tweet_user.length + 2) + ")", 1000);
		}
		
		function respondToRetweetButton() {
			postRetweet();
		}
		
		function respondToFavouriteButton() {
			postFavourite();
		}
		
		function respondToRetweetWithMessageButton() {
			$('#tweet_textarea').value = 'RT @' + str_tweet_user + ' ' + str_tweet_raw;
			$('#in_reply_to_status_id').fill(reply_id);
			gotoPage('#tweet_view');
			countTweetChars();
			
			setTimeout("setCaretToPos($('#tweet_textarea'), 0, 0)", 1000);
		}
		
		function executeView( view_name ) {
			switch ( view_name ) {
				case '#user_view':
					setTimeout("setCaretToPos($('#user_textarea'), 0, 0)", 1000);
					break;
				case '#search_view':
					setTimeout("setCaretToPos($('#search_textarea'), 0, 0)", 1000);
					break;
				case '#options_timeline_view':
					var content = $("#timeline_settings_text").empty();
					content.xhr("data/timeline_settings.html", {
						successCallback: function() {
							content.fill($.make($.responseText));
					    	$("#activityChoices").UISelectionList(function(item) {
					    		status_count = item.getAttribute("ui-value");
					    		localStorage.setItem('status_count', status_count);
						    });
						    $('#num_timeline_' + status_count).addClass("selected");
						    $.responseText = null;
					    }
					});
					break;
				case '#options_account_view':
					if ( accountIsSet == null ) {
						var content = $("#account_settings_text").empty();
						content.xhr("data/account_settings_notsetup.html");
					}
					else {
						var content = $("#account_settings_text");
						content.xhr("data/account_settings.html", {
						    successCallback: function() {
						    	var str_response = $.responseText;
						    	str_response = str_response.replace('${screen_name}', accountScreenName);
						        content.fill($.make(str_response));
						        $.responseText = null;
						    }
						}); 
					}
					break;
			}
		}
		
		function countTweetChars() {
			var chars_remaining = 140 - $('#tweet_textarea').value.length;
			
			$('#tweet_chars').fill(String(chars_remaining));
		}
		
		function setSelectionRange(input, selectionStart, selectionEnd) {
		  if (input.setSelectionRange) {
		    input.focus();
		    input.setSelectionRange(selectionStart, selectionEnd);
		  }
		  else if (input.createTextRange) {
		    var range = input.createTextRange();
		    range.collapse(true);
		    range.moveEnd('character', selectionEnd);
		    range.moveStart('character', selectionStart);
		    range.select();
		  }
		}
		
		function setCaretToPos (input, pos) {
		  setSelectionRange(input, pos, pos);
		}
		
		$.ready(function() {
			$.app.delegate("uibutton", "click", function(item) {
	            if (item.getAttribute("ui-implements") === "back-custom") {
	               goBack();
	            }
	        });
	        
	        $("#btn_compose").bind("click", function() {
	        	$('#tweet_textarea').value = '';
	        	$("#tweet_result").empty();
			    gotoPage('#tweet_view');
			    
			    setTimeout("setCaretToPos($('#tweet_textarea'), 0, 0)", 500);
			});
			
			$("#btn_inbox").bind("click", function() {
			    gotoPage('#inbox_view');
			});

			$("#btn_options").bind("click", function() {
			    gotoPage('#options_view');
			});

			$("#btn_listprev").bind("click", function() {
			    viewListPrev(accountID, accountScreenName);
			});

			$("#btn_lists").bind("click", function() {
			    goLists(accountID, accountScreenName);
			});

			$("#btn_all").bind("click", function() {
			    doRefresh();
			});
			
			$("#btn_listnext").bind("click", function() {
			    viewListNext(accountID, accountScreenName);
			});
			
			if ( just_launched == 1 ) {
				just_launched = 0;
				if ( accountIsSet != null ) {
					doRefresh();
				}
				else {
					gotoPage('#options_account_view');
				}
			}
		});
	</script>
</head>
<body>
	<app>
		<view ui-navigation-status="current" id="main" ui-background-style="slanted-right">
			<subview id="timeline_subview" ui-associations="withBottomToolBar"></subview>
			<toolbar ui-placement="bottom">
				<segmentedcontrol>
					<uibutton id="btn_compose" class="ui-custom-tint">
			            <label>Compose</label>
			       	</uibutton>
			        <uibutton id="btn_inbox" class="ui-custom-tint">
			            <label>Inbox</label>
			        </uibutton>
			        <uibutton id="btn_options" class="ui-custom-tint">
			            <label>Options</label>
			       </uibutton>
			   	</segmentedcontrol>
			   
			   	<segmentedcontrol>
			   		<uibutton class="ui-custom-tint">
			            <label id="btn_current_view"><span onclick="doRefresh();"><img src="images/refresh.png" style="vertical-align: text-bottom;" /> All</span></label>
		       		</uibutton>
		       	</segmentedcontrol>
			    
				<segmentedcontrol ui-bar-align="right">
					<uibutton id="btn_listprev" class="ui-custom-tint">
			            <label>Previous</label>
			       	</uibutton>
			        <uibutton id="btn_all" class="ui-custom-tint" style="width: 55px;">
			            <label>All</label>
			       	</uibutton>
			       	<uibutton id="btn_lists" class="ui-custom-tint">
			            <label>Lists</label>
			        </uibutton>
			       	<uibutton id="btn_listnext" class="ui-custom-tint" style="width: 61px;">
			            <label>Next</label>
			       	</uibutton>
			   	</segmentedcontrol>
        	</toolbar>
        	<screencover ui-visible-state="hidden"></screencover>
		</view>
		
		<view ui-navigation-status="upcoming" id="options_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Options</h1> 
			</navbar> 
			<subview id="options_subview" ui-associations="withNavBar"> 
				<scrollpanel> 
					<tableview style="margin-top: 16px;"> 
						<tablecell onclick="gotoPage('#options_account_view');" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>Account Settings</celltitle> 
						</tablecell>
						<tablecell onclick="gotoPage('#options_timeline_view');" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>Timeline Settings</celltitle> 
						</tablecell>
					</tableview> 
				</scrollpanel> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="options_account_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Account Settings</h1> 
			</navbar> 
			<subview id="options_account_subview" ui-associations="withNavBar"> 
				<scrollpanel> 
					<tableview style="margin-top: 16px;" ui-kind="grouped"> 
						<tablecell class="ui-no-hover"> 
					        <celldetail id="account_settings_text" class="ui-custom-tint"></celldetail>
						</tablecell> 
					</tableview> 
				</scrollpanel> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="options_timeline_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Timeline Settings</h1> 
			</navbar> 
			<subview id="timeline_settings_subview" ui-associations="withNavBar"> 
				<scrollpanel> 
					<tableview style="margin-top: 16px;" ui-kind="grouped"> 
						<tablecell class="ui-no-hover"> 
					        <celldetail id="timeline_settings_text" class="ui-custom-tint"></celldetail>
						</tablecell> 
					</tableview> 
				</scrollpanel> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="inbox_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Inbox</h1> 
			</navbar> 
			<subview id="inbox_subview" ui-associations="withNavBar"> 
				<scrollpanel> 
					<tableview style="margin-top: 16px;"> 
						<tablecell onclick="viewDirectMessages(1);" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>Direct Messages</celltitle> 
						</tablecell>
						<tablecell onclick="viewMentions(1);" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>Mentions</celltitle> 
						</tablecell>
						<tablecell onclick="gotoPage('#search_view');" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>Search</celltitle> 
						</tablecell>
						<tablecell onclick="gotoPage('#user_view');" class="listoption" ui-implements="detail-disclosure"> 
							<celltitle>View User</celltitle> 
						</tablecell>
					</tableview> 
				</scrollpanel> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="misc_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1 id="misc_header">Header</h1> 
			</navbar> 
			<subview id="misc_subview" ui-associations="withNavBar"> 
				<scrollpanel> 
					<tableview style="margin-top: 16px;" ui-kind="grouped"> 
						<tablecell class="ui-no-hover"> 
					        <celldetail id="misc_text" class="ui-custom-tint">Body</celldetail>
						</tablecell> 
					</tableview> 
				</scrollpanel> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="lists_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Lists</h1> 
			</navbar> 
			<subview id="lists_subview" ui-associations="withNavBar"></subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="search_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Search</h1>
			</navbar> 
			<subview id="search_subview" ui-associations="withNavBar"> 
				<tableview style="margin-top: 16px;" ui-kind="grouped"> 
					<tablecell class="ui-no-hover"> 
						<div style="height: 175px; width: 750px; float: left;">
							<textarea id="search_textarea" class="qnx" style="width: 700px; height: 150px;"></textarea>
						</div>
						<div style="height: 175px; width: 200px; float: left;">
							<div style="width: 200px; height: 70px;">
								<uibutton ui-kind="rounded-rectangle" style="margin: 0;" onclick="doSearch();">
								    <label style="font-family: 'DejaVu Sans', Helvetica, Arial, sans-serif; font-size: 16px;">Search</label>
								</uibutton>
							</div>
						</div>
					</tablecell> 
				</tableview> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="user_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>View User</h1>
			</navbar> 
			<subview id="user_subview" ui-associations="withNavBar"> 
				<tableview style="margin-top: 16px;" ui-kind="grouped"> 
					<tablecell class="ui-no-hover"> 
						<div style="height: 175px; width: 750px; float: left;">
							<textarea id="user_textarea" class="qnx" style="width: 700px; height: 35px;"></textarea>
						</div>
						<div style="height: 175px; width: 200px; float: left;">
							<div style="width: 200px; height: 70px;">
								<uibutton ui-kind="rounded-rectangle" style="margin: 0;" onclick="searchUser();">
								    <label style="font-family: 'DejaVu Sans', Helvetica, Arial, sans-serif; font-size: 16px;">View User</label>
								</uibutton>
							</div>
						</div>
					</tablecell> 
				</tableview> 
			</subview>
		</view>
		
		<view ui-navigation-status="upcoming" id="tweet_view" ui-background-style="slanted-right">
			<navbar> 
					<uibutton class="ui-custom-tint" ui-bar-align="left" ui-implements="back-custom"> 
						<label>Back</label> 
					</uibutton> 
					<h1>Tweet</h1> 
			</navbar> 
			<subview id="tweet_subview" ui-associations="withNavBar">
				<tableview style="margin-top: 16px;" ui-kind="grouped"> 
					<tablecell class="ui-no-hover"> 
						<div style="height: 175px; width: 750px; float: left;">
							<textarea id="tweet_textarea" class="qnx" style="width: 700px; height: 150px;" onclick="countTweetChars();" onkeyup="countTweetChars();"></textarea>
						</div>
						<div style="height: 175px; width: 200px; float: left;">
							<div style="width: 200px; height: 70px;">
								<uibutton ui-kind="rounded-rectangle" style="margin: 0;" onclick="postTweet();">
								    <label style="font-family: 'DejaVu Sans', Helvetica, Arial, sans-serif; font-size: 16px;">Tweet</label>
								</uibutton>
							</div>
							<div id="tweet_result" style="width: 200px; height: 70px; margin-left: 5px;"></div>
							<div style="width: 200px; height: 30px; margin-left: 5px;">
							<span id="tweet_chars">140</span> chars left.
							</div>
							<div id="in_reply_to_status_id" style="display: none;"></div>
						</div>
					</tablecell> 
				</tableview> 
			</subview>
		</view>
	</app>
</body>
</html>
